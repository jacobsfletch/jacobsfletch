include ../mixins/flash-messages
include ../mixins/media/lightswitch

doctype html
html
    head
        //- Initial HTML configuration
        meta(charset="utf-8")
        meta(http-equiv="X-UA-Compatible" content="IE=edge")
        //- Link meta-data
        title #{global.meta.description}
        meta(name="description" content=global.meta.description)
        //- Define the viewport
        meta(name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0")
        meta(name="apple-mobile-web-app-title" content=global.meta.title)
        //- Fullscreen Safari on startup from home screen on Apple and Android devices
        //- meta(name="apple-mobile-web-app-capable" content="yes")
        //- meta(name="mobile-web-app-capable" content="yes")
        //- Link browser favicon
        link(rel="icon" type="image/png" href=global.favicon.url)
        //- Link home screen app icon on Apple devices
        link(rel="apple-touch-icon" href=global.icon.url)
        //- Link startup image on Apple devices
        link(rel="apple-touch-startup-image" href=global.startupImg.url)
        //- Link Sassafras project styles
        link(rel="stylesheet" type="text/css" href="/css/jacobsfletch.min.css")
        if user && user.canAccessKeystone
            link(href="/keystone/styles/content/editor.min.css" rel="stylesheet")
        block css
        block head
    body
        block intro
        input#dock(type='checkbox')
        input#explore(type='checkbox')
        input#filter(type='checkbox')
        input#grid-on(name="grid" type='radio' checked)
        input#grid-off(name="grid" type='radio')
        .app-main
            header.app-header
                .wrapper
                    a.app-title(href='/')
                        h1 jacobsfletch
                    label.tool-toggle(for='dock')
                        .tool-media
                            +lightSwitch()
            footer.app-footer
                .container-dock
                    .container-header
                        .container-title
                            p this website is 100% handmade
                    .container-body
                        nav.menu-vertical
                            ul.menu-body
                                each link in navLinks
                                    li.menu-body-part.btn-main(class=(section == link.key ? 'active' : null))
                                        a.btn-title(target=link.target href=link.href)= link.label
                                            |  >
                        nav.menu-vertical
                            .menu-header
                                .menu-title
                                    h6 coming soon
                            ul.menu-body
                                li.menu-body-part.btn-main
                                    a.btn-title my blog
                                li.menu-body-part.btn-main
                                    a.btn-title my shop
            .app-body
                block appBody

        // JS includes
        // script(src='/js/jacobsfletch.min.js')

        block js
            script.
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
                ga('create', 'UA-72591985-3', 'auto');
                ga('send', 'pageview');

                scrollAnimate = function(selector) {
                    var panel = document.getElementById(selector);
                    var originalOffset = panel.offsetTop;
                    var panelSubtitle = document.getElementById("panelSubtitle");
                    var panelBackground = document.getElementById("panelBackground");
                    var panelLoader = document.getElementById("panelLoader");

                    if (window.addEventListener) {
                        window.addEventListener("mousewheel", wheelHandler, false);
                        window.addEventListener("DOMMouseScroll", wheelHandler, false);
                        window.addEventListener("touchstart", startHandler, false);
                        window.addEventListener("touchmove", moveHandler, false);
                        window.addEventListener("touchend", endHandler, false);
                    }
                    else window.attachEvent("onmousewheel", wheelHandler);

                    var originalOffset = panel.offsetTop;
                    var desktopThreshold = 300;
                    var mobileThreshold = 66;
                    var moveDistance = 0;
                    var currentPercentage = 0;
                    var ratio = 3;
                    var start = 0;

                    function startHandler(event) {
                        start = event.touches[0].pageY;
                    }

                    function moveHandler(event) {
                        checkbox = document.getElementById("explore");
                        moveDistance = (start - event.touches[0].pageY);
                        currentPercentage = Math.floor((moveDistance / mobileThreshold) * 100);
                        if(!checkbox.checked) {
                            if(moveDistance > 0) {
                                panelSubtitle.innerHTML = "<p>" + currentPercentage + "%</p>";
                                currentOffset = (originalOffset - (moveDistance * ratio));
                                if(moveDistance > mobileThreshold) {
                                    checkbox.checked = true;
                                    panel.style.top = "";
                                    panelSubtitle.innerHTML = "";
                                    panelBackground.style.opacity = 0;
                                } else {
                                    panel.style.top = currentOffset + "px";
                                    panelBackground.style.display = "none";
                                }
                            }
                        } else if(checkbox.checked){
                            panelBodyScroll = document.getElementById("panelBody").scrollTop;
                            if((moveDistance < 0) && (panelBodyScroll <= 0)) {
                                panelSubtitle.innerHTML = "<p>" + (currentPercentage * -1) + "%</p>";
                                currentOffset = ((moveDistance * -1) * ratio);
                                if((moveDistance * -1) > mobileThreshold) {
                                    checkbox.checked = false;
                                    panel.style.top = "";
                                    panelSubtitle.innerHTML = "";
                                    panelBackground.style.opacity = "";
                                } else {
                                    panel.style.top = currentOffset + "px";
                                }
                            }
                        }
                    }

                    function endHandler(event) {
                        panel.style.top = "";
                        panelSubtitle.innerHTML = "";
                        panelBackground.style.opacity = "";
                        if(!checkbox.checked) {
                            panelBackground.style.display = "";
                        }
                    }

                    function wheelHandler(event) {
                        wheelDistance = event.wheelDelta || -event.detail;
                        if(wheelDistance < 0) { // Scrolling Up

                        }
                    }
                }

                scrollAnimate("panelExplore");
